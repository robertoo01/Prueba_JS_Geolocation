<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Captura Geolocalización</title>
  </head>
  <body>
	  <h1>APLICACIÓN WEB EXCLUSIVA DE USO ACADÉMICO</h1>
    	<h1>Esta aplicación captura, en modo local, la posición geográfica de su dispositivo móvil</h1>
	  <h1>No guarda ningun dato</h1>
	<button onclick="dialogo()">Click</button>
    	<script>
		let hash_pass="";

		//FUNCION ASINCRONA SACADA DE https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest
		//-----------------------------------------------------------------------------------------------------------------
		async function digestMessage(message) {
  			const msgUint8 = new TextEncoder().encode(message);                           // encode as (utf-8) Uint8Array
  			const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);           // hash the message
  			const hashArray = Array.from(new Uint8Array(hashBuffer));                     // convert buffer to byte array
  			const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
  			return hashHex;
		}
		//-----------------------------------------------------------------------------------------------------------------

		
		function dialogo(){
			const pass = prompt("Contraseña", "Contraseña");
			//Llamamos a la funcion para hashear la contraseña que se introduce por pantalla
			digestMessage(pass).then((digestHex) => guardar_promesa(digestHex));
			if(hash_pass== "e9ed65d0137ba9d49a6abd7b0b075303a914cd80fc1872aa4781217e082aa843"){
				geo();
			} else{
				alert("Contraseña incorrecta. Piensa...");
			}
		}
		function guardar_promesa(hash){
			hash_pass=hash;
		}
	      function geo(){
			navigator.geolocation.getCurrentPosition(function(position) {
			    var latitud = position.coords.latitude;
			    var longitud= position.coords.longitude;
			    alert(latitud + " " + longitud);
			  }, function(error) {
			      console.log("Error al obtener la posición geográfica: " + error.message);
			    alert("err");
			});
	      }
	</script>
  </body>
</html>
